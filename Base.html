<!-- 
Alexis Brunner
Cosc 4345, Section 01
9/14/24
Creates a graphic for a city skyline with a graph over the skyline. Uses a
golden, grey, blue, and purple color scheme. 
-->
<html>
    <style type = "text/css">
        canvas {background: red}
    </style>

    <script type = "text/javascript" src = "webgl-utils.js"></script>
    <script type = "text/javascript" src = "initShaders.js"></script>
    <script type = "text/javascript" src = "verticalGradient.js"></script>
    <script type = "text/javascript" src = "Skyline.js"></script>

    <script id="vertex-shader" type = "x-shader/x-vertex">
        attribute vec4 vPos;
        void main() {
            gl_Position = vPos;
        }
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">
        precision mediump float;
        uniform vec4 u_color;

        void main() {
            gl_FragColor = u_color;
        }
    </script>

    <script type = "text/javascript">
        var canvas;
        var gl;

        window.onload = init;

        //Initializing canvas with width/height defined in body + painting background
        function init() {
            canvas = document.getElementById("gl-canvas");
            gl = WebGLUtils.setupWebGL(canvas);

            if(!gl) {
                alert("WebGL is not available :(");
            }

            gl.viewport(0,0, canvas.width, canvas.height);

            gl.clearColor(0.89, 0.73, .45, 1.0);
            gl.clear(gl.COLOR_BUFFER_BIT);

            var program = initShaders(gl, "vertex-shader", "fragment-shader");
            gl.useProgram(program);

            var vPos = gl.getAttribLocation(program, "vPos");
            var colorUniformLocation = gl.getUniformLocation(program, "u_color");
            var buffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);

            //We're starting with a gradient, going from gold to dark blue to purple.
            var gradientColors = [
                [0.99, 0.94, 0.68, 1.0],
                [0.91, 0.88, 0.66, 1.0], 
                [0.91, 0.84, 0.54, 1.0],
                [0.89, 0.73, .45, 1.0],
                [0.8, 0.59, 0.4, 1.0],
                [0.74, 0.58, 0.4, 1.0],
                [0.56, 0.52, 0.5, 1.0],
                [0.27, 0.27, 0.3, 1.0],
                [0.13, 0.24, 0.29, 1.0],
                [0.2, 0.1, 0.25, 1.0]
            ];
            var skylineColors = [
                [0.63, 0.29, 0.48, 1.0], //Is this too bright?
                [0.4, 0.27, 0.38, 1.0]
            ];
            //TODO: Add more colors and change value in verticalGradient() accordingly

            //Don't forget to change numberOfColors as colors are added.
            var vertices = verticalGradient(-1.0, 1.0, -1.0, 1.0, 9);

            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);

            gl.useProgram(program);
            gl.enableVertexAttribArray(vPos);
            gl.vertexAttribPointer(vPos, 2, gl.FLOAT, false, 0, 0);

            //Now to actually start drawing stuff.

            //Drawing the gradient
            for (i = 0; i < gradientColors.length; i++) {
                gl.uniform4f(colorUniformLocation, gradientColors[i][0], gradientColors[i][1],
                    gradientColors[i][2], 1);
                gl.drawArrays(gl.TRIANGLE_FAN, i * 4, 4);
            }
            

            //Now for the entire back skyline
            
            /*backgroundSkylineBase has 4 vertices, tiltedTower has 4 vertices each,
            curvedTower has 35 vertices each, lines will have 2
            */
            var backgroundSkylineBase = returnVerticesSkylineBase(-0.7);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(backgroundSkylineBase), gl.STATIC_DRAW);
            gl.uniform4f(colorUniformLocation, skylineColors[0][0], 
                skylineColors[0][1], skylineColors[0][2], skylineColors[0][3]);
            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);

            var backgroundSkyline = returnVerticesTiltedTower(-1.0, -0.9, 0.1, 0.0, -0.7);
            backgroundSkyline = backgroundSkyline.concat(returnVerticesTiltedTower(-0.85, -0.5, -0.1, 0.2, -0.7));
            backgroundSkyline = backgroundSkyline.concat(returnVerticesCurvedTower(-0.4, -0.1, -0.7, 0.1));
            backgroundSkyline = backgroundSkyline.concat(returnVerticesPointedTower(0.1, 0.3, -0.7, 0.3));
            backgroundSkyline.push(0.2, 0.3,     0.2 ,0.4); //Needle to be drawn with a line
            backgroundSkyline = backgroundSkyline.concat(returnVerticesTiltedTower(0.4, 0.6, 0.1, -0.2, -0.7));
            backgroundSkyline = backgroundSkyline.concat(returnVerticesCurvedTower(0.7, 1.2, -0.7, 0.2));

            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(backgroundSkyline), gl.STATIC_DRAW);

            gl.uniform4f(colorUniformLocation, skylineColors[0][0], skylineColors[0][1],
                skylineColors[0][2], skylineColors[0][3]);
            gl.drawArrays(gl.TRIANGLE_FAN, 0, 4);
            gl.drawArrays(gl.TRIANGLE_FAN, 4, 4);
            gl.drawArrays(gl.TRIANGLE_FAN, 8, 35);
            gl.drawArrays(gl.TRIANGLE_FAN, 43, 5);
            gl.drawArrays(gl.LINES, 48, 2);
            gl.drawArrays(gl.TRIANGLE_FAN, 50, 4);
            gl.drawArrays(gl.TRIANGLE_FAN, 54, 35);



            //Now for the second skyline
            var secondSkylineBase = returnVerticesSkylineBase(-0.8);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(secondSkylineBase), gl.STATIC_DRAW);
            gl.uniform4f(colorUniformLocation, skylineColors[1][0], skylineColors[1][1], skylineColors[1][2], skylineColors[1][3]);
            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
        }
    </script>

    <body>
        <canvas id = "gl-canvas" width = "1028" height = "512">
            Oopsy!
        </canvas>
    </body>
</html>