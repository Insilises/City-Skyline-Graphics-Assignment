<!-- 
Alexis Brunner
Cosc 4345, Section 01
9/14/24
Creates a graphic for a city skyline with a graph over the skyline. Uses a
golden, grey, blue, and purple color scheme. 
-->
<html>
    <style type = "text/css">
        canvas {background: red}
    </style>

    <script type = "text/javascript" src = "webgl-utils.js"></script>
    <script type = "text/javascript" src = "initShaders.js"></script>
    <script type = "text/javascript" src = "verticalGradient.js"></script>
    <script type = "text/javascript" src = "Skyline.js"></script>

    <script id="vertex-shader" type = "x-shader/x-vertex">
        attribute vec4 vPos;
        void main() {
            gl_Position = vPos;
        }
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">
        precision mediump float;
        uniform vec4 u_color;

        void main() {
            gl_FragColor = u_color;
        }
    </script>

    <script type = "text/javascript">
        var canvas;
        var gl;

        window.onload = init;

        //Initializing canvas with width/height defined in body + painting background
        function init() {
            canvas = document.getElementById("gl-canvas");
            gl = WebGLUtils.setupWebGL(canvas);

            if(!gl) {
                alert("WebGL is not available :(");
            }

            gl.viewport(0,0, canvas.width, canvas.height);

            gl.clearColor(0.89, 0.73, .45, 1.0);
            gl.clear(gl.COLOR_BUFFER_BIT);

            var program = initShaders(gl, "vertex-shader", "fragment-shader");
            gl.useProgram(program);

            var vPos = gl.getAttribLocation(program, "vPos");
            var colorUniformLocation = gl.getUniformLocation(program, "u_color");
            var buffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);

            //Don't forget to change numberOfColors as colors are added.
            var vertices = verticalGradient(-1.0, 1.0, -1.0, 1.0, 5);

            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);

            gl.useProgram(program);
            gl.enableVertexAttribArray(vPos);
            gl.vertexAttribPointer(vPos, 2, gl.FLOAT, false, 0, 0);

            //Now to actually start drawing stuff.
            //We're starting with a gradient, going from gold to dark blue to purple.
            
            var colors = [
                //vertical gradient colors
                [0.89, 0.73, .45, 1.0],
                [0.8, 0.59, 0.4, 1.0],
                [0.56, 0.52, 0.5, 1.0],
                [0.27, 0.27, 0.3, 1.0],
                [0.13, 0.24, 0.29, 1.0],
                [0.2, 0.1, 0.25, 1.0],

                //Beginning backgroundSkyline colors
                [0.4, 0.27, 0.38, 1.0]
            ];
            //TODO: Add more colors and change value in verticalGradient() accordingly
            
            //Drawing the gradient
            for (i = 0; i < colors.length; i++) {
                gl.uniform4f(colorUniformLocation, colors[i][0], colors[i][1], colors[i][2], 1);
                gl.drawArrays(gl.TRIANGLE_FAN, i * 4, 4);
            }
            

            //Now for the buildings
            /*TODO: Would it be hard to add shading and make the objects seem 3D?
            Could we pick a slightly darker color, and since we know how the shape is
            drawn (via the vertices array), could we do checks to see if that area would
            be further away from the sun in the back? Then, we just create a new shape over
            the existing shape?

            Obviously, I could since these shapes are predetermined, but I'm trying to think
            of a modular way to do this for practice.
            */
            
            /*backgroundSkylineBase has 4 vertices, tiltedTower has 4 vertices each,
            curvedTower has ___ vertices each
            */
            var backgroundSkylineBase = returnVerticesSkylineBase(-0.5);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(backgroundSkylineBase), gl.STATIC_DRAW);
            gl.uniform4f(colorUniformLocation, colors[6][0], colors[6][1], colors[6][2], colors[6][3]);
            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);

            var backgroundSkyline = returnVerticesTiltedTower(-1.0, -0.9, 0.1, 0.0, -0.7);
            backgroundSkyline = backgroundSkyline.concat(returnVerticesTiltedTower(-0.85, -0.5, -0.1, 0.2, -0.7));
            backgroundSkyline = backgroundSkyline.concat(returnVerticesCurvedTower(-0.4, -0.1, -0.7, 0.1));

            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(backgroundSkyline), gl.STATIC_DRAW);

            gl.uniform4f(colorUniformLocation, colors[6][0], colors[6][1], colors[6][2], colors[6][3]);
            gl.drawArrays(gl.TRIANGLE_FAN, 0, 4);
            gl.drawArrays(gl.TRIANGLE_FAN, 4, 4);
            gl.drawArrays(gl.TRIANGLE_FAN, 8, 35);

        }
    </script>

    <body>
        <canvas id = "gl-canvas" width = "1028" height = "512">
            Oopsy!
        </canvas>
    </body>
</html>